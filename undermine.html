<!doctype html>
<html>
<head>
<style type='text/css'>
canvas {
  border: 1px solid #aaa;
}
</style>

<script type="text/javascript" src="jquery-1.4.3.min.js"></script>
<script type="text/javascript">
var context;
var width = 500;
var height = 500;

var turn = 0; //index
var scores = [0, 0];
var choices = [];
var levels = ["purple", "blue", "green", "yellow", "orange", "red"];
var cursor = {x: 0, y:0};

function drawCircle(p,colour,radius) {
	console.log("p" + radius);
	context.fillStyle = colour;
	context.beginPath();
	context.arc(p.x,p.y,radius,0,Math.PI*2,true);
	context.closePath();
	context.fill();
}

function drawRect(x,y,w,h, colour) {
	context.fillStyle = colour;
	context.fillRect(x,y,w,h);
}

function setBackground() {
	context.clearRect(0, 0, width, height);
	context.fillStyle = "black";
	context.fillRect(0,0,width,height);
}

var mouseSelection = 0;

function drawLevels() {
	var dx = width * .33;
	var dy = height * .33;
	var w = 25;
	var h = 25;

	for (var i = 0; i < levels.length; i++) {
		if (cursor.y > dy) {
			mouseSelection = i;
		}

		levelX = dx - (w * i * .5);
		levelW = w * (i + 1);
		drawRect(levelX, dy, levelW, h, levels[i]);
		context.fillStyle = "black";

		context.font         = 'bold 30px courier-new';
		context.textBaseline = 'top';

	  context.fillText(i + 1, dx + 5, dy);
		dy+= h;
	}

	if (choices[0] == -1 && turn == 0) {
    drawRect(dx - 100, (height * .33) + (25 * mouseSelection) + 12.5, 30, 2, "green");
    msg = "Player 1 selects depth of influence.";
	} else if (choices[1] == -1 && turn == 1) {
		drawRect(dx + 100, (height * .33) + (25 * mouseSelection) + 12.5, 30, 2, "red");	
		msg = "Player 2 selects depth of influence.";
	} else {
		msg = "Move cursor here.";
	}

	showMsg(msg);

	// if (choices[0] == -1) {
	// 	drawRect(dx - 100, (height * .33) + (25 * mouseSelection) + 12.5, 30, 2, "green");
 //  }
}

function showMsg(msg) {
	context.fillStyle = "white";	
	context.font         = '28px courier-new';
	context.textBaseline = 'center';

	context.fillText(msg, 90, 400);
}

function clearChoices() {
	choices = [-1, -1];
}

function drawUndermine() {
	context.fillStyle = "white";

	context.font         = 'bold 45px times-new-roman';
	context.textBaseline = 'center';

  context.fillText("UNDERMINE", 100, 350);

	drawRect(0,320,500,2, "white");
}

function draw() {
	setBackground();
	drawLevels();
	
	drawUndermine();
}

function getTime() {
  return new Date().getTime() / 1000;
}

function elapsedTime() {
  return getTime() - start;
}

function undermine() {
	if (choices[0] == 1 && choices[1] == 6) {
		scores[0] += 1;
	} else if (choices[1] == 1 && choices[0] == 6) {
		scores[1] += 1;
	} else {
		if (choices[0] - choices[1] == 2) {
			scores[0] += choices[1];
		} else if (choices[1] - choices[0] == 2) {
			scores[1] += choices[0];
		} else {
			scores[0] += choices[0];
			scores[1] += choices[1];
		}
	}

	console.log("Score P1: " + scores[0]);
  console.log("Score P2: " + scores[1]);

	clearChoices();
}

$(document).ready(function() {
  start = getTime();

  var canvas = $('#canvas');
  context = canvas.get(0).getContext('2d');

	canvas.click(function(e) {
    cursor.x = e.pageX;
    cursor.y = e.pageY;

		choices[turn] = mouseSelection + 1;

		if (turn == 1 && choices[1] > -1) {
			undermine();
			turn = Math.abs(1 - turn);
		} else {

		}

	});

  canvas.mousemove(function(e) {
	  cursor.x = e.pageX;
    cursor.y = e.pageY;

    if (cursor.y > 320) {
    	if (choices[turn] > -1) {
    		turn = Math.abs(1 - turn);
    	}
    }
  });

   clearChoices();
   console.log(choices);
  setInterval(draw, 10);
});

</script>
</head>
<body>
<canvas id='canvas' width=500 height=500></canvas>
</body>
</html>